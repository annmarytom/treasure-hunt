<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Treasure Hunt</title>
    <style>
        #puzzle, #photo, #okButton, #hint { display: none; }
    </style>
</head>
<body>

    <div id="scanner"></div>
    <div id="puzzle">
        <h2>Puzzle: <span id="puzzleText"></span></h2>
        <img id="questionImage" src="" alt="Puzzle Question Image" style="max-width: 300px;" />
        <input type="text" id="answerInput" placeholder="Enter your answer" />
        <button id="submitAnswer">Submit Answer</button>
    </div>
    <div id="photo">
        <img id="photoImage" src="" alt="Puzzle Answer Photo" />
        <button id="okButton">OK</button>
    </div>
    <div id="hint">
        <h3>Hint for the next stage:</h3>
        <p id="nextHint"></p>
    </div>

    <!-- Correct HTML5-Qrcode script -->
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

    <script>
        // Modified puzzles object with hints for the next stage
        const puzzles = {
            "qrcode1": { 
                question: "How many triangles are selected?", 
                answer: "3", 
                image: "correct.jpg", 
                questionImage: "photo1.jpg", 
                hint: "Proceed to the room with the red door."
            },
            "qrcode2": { 
                question: "What is the capital of France?", 
                answer: "Paris", 
                image: "correct.jpg", 
                questionImage: "photo2.jpg", 
                hint: "Look under the table near the window."
            }
        };

        let currentPuzzle = null;

        function openScanner() {
            const html5QrCode = new Html5Qrcode("scanner");
            html5QrCode.start(
                { facingMode: "environment" },
                { fps: 10, qrbox: 250 },
                qrCodeMessage => {
                    handleQRCode(qrCodeMessage);
                    html5QrCode.stop();
                },
                errorMessage => {
                    console.error(errorMessage);
                }
            ).catch(err => {
                console.error(err);
            });
        }

        function handleQRCode(qrCode) {
            if (puzzles[qrCode]) {
                currentPuzzle = puzzles[qrCode];
                document.getElementById("puzzleText").innerText = currentPuzzle.question;
                document.getElementById("questionImage").src = currentPuzzle.questionImage; // Set the question image
                document.getElementById("puzzle").style.display = 'block';
                document.getElementById("hint").style.display = 'none'; // Hide the hint initially
            }
        }

        document.getElementById("submitAnswer").addEventListener("click", function () {
            const answer = document.getElementById("answerInput").value;
            if (answer === currentPuzzle.answer) {
                document.getElementById("photoImage").src = currentPuzzle.image;
                document.getElementById("photo").style.display = 'block';
                document.getElementById("puzzle").style.display = 'none';
                document.getElementById("nextHint").innerText = currentPuzzle.hint; // Set the hint for the next stage
                document.getElementById("hint").style.display = 'block'; // Show the hint
            } else {
                alert("Incorrect answer!");
            }
        });

        document.getElementById("okButton").addEventListener("click", function () {
            document.getElementById("photo").style.display = 'none';
            openScanner();  // Reopen the scanner for the next QR code
        });

        // Start by opening the scanner
        openScanner();
    </script>

</body>
</html>
